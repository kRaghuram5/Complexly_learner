<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Complex Number Quiz</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<!-- MathJax configuration (must be before script load) -->
<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
  svg: { fontCache: 'global' }
};
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background-color: #1a1a2e;
    color: #d1d1d1;
    min-height: 100vh;
}
.background-layer {
    position: fixed; inset: 0;
    background: radial-gradient(circle at 50% 50%, rgba(255,215,0,0.1) 0%, rgba(26,26,46,1) 70%);
    z-index: 0;
}
.quiz-container {
    display: flex; flex-wrap: wrap;
    width: 90%; max-width: 1200px;
    margin: 2rem auto; gap: 2rem; position: relative; z-index: 10;
}
.quiz-box, .tracker-box {
    background: rgba(42,42,68,0.4);
    backdrop-filter: blur(10px) saturate(180%);
    -webkit-backdrop-filter: blur(10px) saturate(180%);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 16px; padding: 2rem;
}
.quiz-box { flex: 3; min-width: 320px; position: relative; }
.tracker-box { flex: 1; min-width: 260px; text-align: center; }
h3 { color:#fff; font-weight:600; margin-bottom:1rem; }
.question-number { font-weight:bold; margin-bottom:1rem; color:#ffd700; }
.form-control {
    background-color: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    color: #fff;
    padding: 12px; margin-bottom:1rem; border-radius:8px; font-size:1rem;
}
.buttons button {
    background-color: #007bff; border:none; padding:10px 20px;
    color:#fff; border-radius:8px; font-weight:bold; margin-right:10px;
}
.buttons button:hover { background-color:#0056b3; }
.tracker-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:10px; }
.tracker-item { background-color:#555; color:#fff; font-weight:bold; border-radius:10px; height:40px;
    display:flex; justify-content:center; align-items:center; cursor:pointer; user-select:none; }
.tracker-item.answered { background-color:#28a745; }
.results { margin-top:2rem; }
.btn-secondary, .exit-link {
    margin-top:10px; display:inline-block;
    padding:10px 20px; background-color:#343a40; color:white;
    border-radius:8px; text-decoration:none; font-weight:500;
}
.btn-secondary:hover, .exit-link:hover { background-color:#1c1f23; }
#timer { position:absolute; top:15px; right:20px; font-weight:bold; color:#e74c3c; font-size:1.2em; }
</style>
</head>
<body>
<div class="background-layer"></div>

<div class="quiz-container">
<div class="quiz-box" id="quiz-box" data-seconds-left="{{ time_remaining|default(0)|int }}">
    {% if not submitted %}
    <div id="timer"></div>
    {% endif %}

    <form method="POST" id="quiz-main-form">
        <input type="hidden" name="jump_to_index" id="jump_to_index">
        <input type="hidden" name="action" id="action">

        <!-- âœ… This hidden field carries the correct answer temporarily -->
        <input type="hidden" name="correct_answer" value="{{ correct_answer }}">

        <div class="question-number">Question {{ index + 1 }} of {{ total }}</div>
        <h3>{{ question|safe }}</h3>

        {% for option in options %}
        <div class="form-check mb-2">
            <input class="form-check-input" type="radio" name="answer" id="option{{ loop.index }}" value="{{ option }}"
                   {% if answers[index] == option %}checked{% endif %}>
            <label class="form-check-label text-white" for="option{{ loop.index }}">
                {{ option|safe }}
            </label>
        </div>
        {% endfor %}

        <div class="buttons">
            {% if index > 0 %}
            <button type="submit" onclick="setAction('prev')">Previous</button>
            {% endif %}
            {% if index < ( total - 1) %}
            <button type="submit" onclick="setAction('next')">Next</button>
            {% endif %}
            {% if index == total - 1 %}
            <button type="submit" onclick="setAction('submit')">Submit</button>
            {% endif %}
        </div>
    </form>

    {% if submitted %}
    <div class="results">
        <h4 class="text-warning">Quiz Completed</h4>
        <a href="/quiz-select" class="btn btn-secondary">Start New Quiz</a>
        <a href="/" class="exit-link">Exit</a>
    </div>
    {% endif %}
</div>

<div class="tracker-box">
    <h4 class="text-light mb-3">Progress</h4>
    <div class="tracker-grid">
        {% for i in range(total|default(0)) %}
        <div class="tracker-item {% if answers is defined and (answers|length > i) and answers[i] %}answered{% endif %}"
             onclick="jumpToQuestion({{ i }})">
            {{ i+1 }}
        </div>
        {% endfor %}
    </div>
</div>
</div>

<script>
function submitOnce(form) {
    if(form.dataset.submitted==="1") return false;
    form.dataset.submitted="1";
    form.submit();
    return true;
}
function jumpToQuestion(index){
    const form = document.getElementById("quiz-main-form");
    document.getElementById("jump_to_index").value = index;
    document.getElementById("action").value = "jump";
    submitOnce(form);
}
function setAction(actionValue){
    const form = document.getElementById("quiz-main-form");
    document.getElementById("action").value = actionValue;
    submitOnce(form);
}

// Background parallax
const bg=document.querySelector(".background-layer");
let currentX=0.5, currentY=0.5, easeFactor=0.1;
document.addEventListener("mousemove", e=>{
    const targetX=e.clientX/window.innerWidth;
    const targetY=e.clientY/window.innerHeight;
    currentX+=(targetX-currentX)*easeFactor;
    currentY+=(targetY-currentY)*easeFactor;
    bg.style.background=`radial-gradient(circle at ${currentX*100}% ${currentY*100}%, rgba(255,215,0,0.1) 0%, rgba(26,26,46,1) 70%)`;
});

// Run MathJax after page content loads
document.addEventListener("DOMContentLoaded", () => {
    if (window.MathJax) {
        MathJax.typesetPromise();
    }
});
</script>
</body>
</html>
